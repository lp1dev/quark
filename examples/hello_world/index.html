<!DOCTYPE html>
<html>

<head>
  <title>Quark Hello World</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <div id="container">
    <h1 id="title">Hello, World</h1>
    <p id="outputarea">Hello from Quark!</p>
    <p id="keypressed">No key pressed.</p>
    <button id="button" onclick="counterup()">Here's a button!</button>
  </div>

  <script type="text/javascript">
    var counter = 0

    function counterup() {
      var text = document.getElementById("outputarea")
      console.log("Button clicked!")
      counter += 1
      text.innerText = "You have clicked the button " + counter + " time(s)!"
    }

   document.addEventListener("keydown", function(event) {
      var keypressed = document.getElementById("keypressed")
      keypressed.innerText = "Key pressed " + event.code
   })
  
   document.addEventListener("gamepadconnected", function(event) {
    console.log("GAMEPAD CONNECTED")
   })
   

    function loop() {
      var gamepad = navigator.getGamepads()[0] // Default console controller
      // The mapping comes from
      // https://wiki.libsdl.org/SDL2/SDL_GameControllerButton
      //
      var mapping = [ 
        "INVALID", 
        "A", 
        "B",
        "X",
        "Y",
        "BACK",
        "GUIDE",
        "LEFTSTICK",
        "RIGHTSTICK",
        "LEFTSHOULDER",
        "RIGHTSHOULDER",
        "DPAD_UP",
        "DPAD_DOWN",
        "DPAD_LEFT",
        "DPAD_RIGHT",
      ] // Only implemented the first 15 buttons
        // TODO : Add the rest
      for (var i = 0; i < mapping.length; i++) {
        if (gamepad.buttons[i].pressed) {
          console.log(mapping[i], "pressed")
          document.getElementById("keypressed").innerText = mapping[i] + " pressed!!"
        }
      }
      // console.log("Gamepads :: ", JSON.stringify(navigator.getGamepads()), typeof(navigator.getGamepads()))
    }

    setInterval(loop, 100)
  </script>

</body>

</html>
